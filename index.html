4<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ration Shop Status Dashboard - Single File</title>
    <style>
        /* --- CSS STYLES --- */
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        .dashboard { max-width: 600px; margin: 30px auto; padding: 25px; border: 1px solid #ddd; border-radius: 10px; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 20px; }
        .status-item { padding: 12px 0; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between; align-items: center; }
        .status-item:last-child { border-bottom: none; }
        .user-controls { margin-top: 25px; padding: 15px; border: 1px solid #007bff; border-radius: 5px; background-color: #eaf4ff; }
        .login-status { font-weight: bold; margin-bottom: 15px; color: #0056b3; }
        .editable input, .editable select { padding: 5px; border: 1px solid #ccc; border-radius: 3px; width: 150px; }
        .edit-button, .save-button { padding: 5px 10px; cursor: pointer; border: none; border-radius: 4px; margin-left: 10px; font-weight: bold; }
        .edit-button { background-color: #007bff; color: white; }
        .save-button { background-color: #28a745; color: white; }
        .control-group { display: flex; align-items: center; }
    </style>
</head>
<body>

    <div class="dashboard">
        <h1>Local Ration Shop Status</h1>

        <div id="shop-data-container">
            </div>

        <div class="user-controls">
            <h2>User Access Control</h2>
            <div class="login-status" id="login-status">Logged in as: User</div>
            <button onclick="loginAs('user')">Login as User</button>
            <button onclick="loginAs('shopowner')">Login as Shop Owner</button>
            <button onclick="loginAs('admin')">Login as Admin</button>
            <p style="margin-top: 10px; font-size: 0.9em; color: #666;">*Editing is enabled only for Admin and Shop Owner roles.</p>
        </div>
    </div>

    <script>
        // =======================================================
        // 1. Data Model Object (DMO) Array
        // =======================================================
        const DMO_ShopData = [
            {
                name: "Shop Status",
                key: "is_open",
                type: "boolean",
                value: true, // true for Open, false for Closed
                editable_by: ["admin", "shopowner"]
            },
            {
                name: "Opening Time (Morning)",
                key: "morning_open",
                type: "time",
                value: "08:30",
                editable_by: ["admin", "shopowner"]
            },
            {
                name: "Closing Time (Morning)",
                key: "morning_close",
                type: "time",
                value: "12:30",
                editable_by: ["admin", "shopowner"]
            },
            {
                name: "Opening Time (Evening)",
                key: "evening_open",
                type: "time",
                value: "15:00",
                editable_by: ["admin", "shopowner"]
            },
            {
                name: "Closing Time (Evening)",
                key: "evening_close",
                type: "time",
                value: "19:00",
                editable_by: ["admin", "shopowner"]
            },
            {
                name: "Current Queue Length (People)",
                key: "queue_length",
                type: "number",
                value: 7, // Placeholder for the number of people
                editable_by: ["admin", "shopowner"]
            },
            {
                name: "Last Updated",
                key: "last_updated",
                type: "string",
                value: new Date().toLocaleString(),
                editable_by: [] // Not directly editable in this UI
            },
        ];


        // =======================================================
        // 2. Application Logic
        // =======================================================

        let currentUserRole = 'user'; // Default role is 'user'
        const shopDataContainer = document.getElementById('shop-data-container');
        const loginStatusElement = document.getElementById('login-status');

        /**
         * Updates the UI based on the current user role and DMO.
         */
        function renderData() {
            shopDataContainer.innerHTML = ''; // Clear previous content

            DMO_ShopData.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'status-item';

                const isEditable = item.editable_by.includes(currentUserRole);

                let valueDisplay;
                let inputField = '';

                // Determine the display value and create input field if editable
                if (item.key === 'is_open') {
                    valueDisplay = item.value ? '<span style="color: green; font-size: 1.1em;">OPEN</span>' : '<span style="color: red; font-size: 1.1em;">CLOSED</span>';
                    if (isEditable) {
                        inputField = `
                            <select id="${item.key}-${index}" disabled>
                                <option value="true" ${item.value ? 'selected' : ''}>OPEN</option>
                                <option value="false" ${!item.value ? 'selected' : ''}>CLOSED</option>
                            </select>
                        `;
                    }
                } else {
                    valueDisplay = item.value;
                    if (isEditable) {
                        const inputType = item.type === 'number' ? 'number' : item.type;
                        inputField = <input type="${inputType}" id="${item.key}-${index}" value="${item.value}" ${item.type === 'string' ? 'size="25"' : ''} disabled>;
                    }
                }

                itemDiv.innerHTML = `
                    <span>${item.name}: <strong>${valueDisplay}</strong></span>
                    <div class="control-group">
                        ${isEditable ? <span class="editable">${inputField}</span> : ''}
                        ${isEditable ? <button class="edit-button" data-index="${index}" onclick="toggleEdit(${index})">Edit</button> : ''}
                        ${isEditable ? <button class="save-button" data-index="${index}" onclick="saveData(${index})" style="display: none;">Save</button> : ''}
                    </div>
                `;

                shopDataContainer.appendChild(itemDiv);
            });

            // Update login status
            loginStatusElement.textContent = Logged in as: ${currentUserRole.toUpperCase()};
        }

        /**
         * Toggles the disabled state of the input field for editing.
         * @param {number} index - Index of the item in DMO_ShopData.
         */
        function toggleEdit(index) {
            const item = DMO_ShopData[index];
            const inputElement = document.getElementById(${item.key}-${index});
            const editButton = document.querySelector(.edit-button[data-index="${index}"]);
            const saveButton = document.querySelector(.save-button[data-index="${index}"]);

            if (inputElement.disabled) {
                inputElement.disabled = false;
                editButton.style.display = 'none';
                saveButton.style.display = 'inline-block';
                inputElement.focus();
            } else {
                // This branch is for cancelling an edit, but for simplicity, we focus on saving.
                inputElement.disabled = true;
                editButton.style.display = 'inline-block';
                saveButton.style.display = 'none';
            }
        }

        /**
         * Saves the new value from the input field to the DMO.
         * @param {number} index - Index of the item in DMO_ShopData.
         */
        function saveData(index) {
            const item = DMO_ShopData[index];
            const inputElement = document.getElementById(${item.key}-${index});

            let newValue = inputElement.value;

            // Type conversion and validation
            if (item.type === 'boolean') {
                newValue = newValue === 'true';
            } else if (item.type === 'number') {
                newValue = parseInt(newValue, 10);
                if (isNaN(newValue) || newValue < 0) {
                    alert("Invalid number entered for Queue Length. Must be a non-negative integer.");
                    return;
                }
            }

            // Update the DMO and last updated time
            item.value = newValue;
            DMO_ShopData.find(d => d.key === 'last_updated').value = new Date().toLocaleString();

            // Re-render the UI to reflect changes and disable inputs
            renderData();
        }

        /**
         * Changes the current user role and re-renders the data.
         * @param {string} role - 'user', 'shopowner', or 'admin'.
         */
        window.loginAs = function(role) {
            currentUserRole = role;
            renderData();
        }
        
        // Expose the functions to the global scope for HTML event handlers
        window.toggleEdit = toggleEdit;
        window.saveData = saveData;


        // Initial render when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderData();
        });

    </script>
</body>
</html>